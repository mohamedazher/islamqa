<!DOCTYPE html>
<!--<html dir="rtl">-->
<html>
    
    <head>
        <title>IslamQA.COM</title>

        <meta http-equiv="content-type" content="text/html;charset=utf-8" />
        <meta charset="UTF-8">
        <!-- <meta name="viewport" content="width=device-width, user-scalable=no"> -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <meta name="apple-mobile-web-app-capable" content="yes">
  		<meta name="apple-mobile-web-app-status-bar-style" content="black">
        <script src="js/jquery-1.8.3.min.js"></script>
         <script type="text/javascript" src="cordova-2.6.0.js"></script>
        <script src="libs/jquery.animate-enhanced.js"></script>
        <script src="libs/iscroll5.js"></script>
        <script src="libs/noClickDelay.js"></script>
        <!-- <script src="js/pushHandler.js"></script> -->
        <script src="js/utilcode.js"></script>
        <script src="js/renderCode.js"></script>
        <script src="js/dbFunctions.js"></script>
        <link rel="stylesheet" href="viewnavigator/viewnavigator.css" type="text/css" />
        <script src="viewnavigator/viewnavigator.js"></script>
        <link rel="stylesheet" href="libs/css/activityIndicator.css" type="text/css" />

        <link rel="stylesheet" href="css/appStyle.css" type="text/css" />
        <link rel="stylesheet" href="css/android.css" type="text/css" />
        <link rel="stylesheet" href="css/main.css" type="text/css" />
        
        <!--  <script type="text/javascript" src="PushNotification.js"></script> -->
        <script type="text/javascript" src="Share/Share.js"></script> 
        <script type="text/javascript" src="js/highlighter.js"></script>
<style>
    /**
   * Eric Meyer's Reset CSS v2.0 (http://meyerweb.com/eric/tools/css/reset/)
   * http://cssreset.com
   */
    html, body, div, span, applet, object, iframe,
    h1, h2, h3, h4, h5, h6, p, blockquote, pre,
    a, abbr, acronym, address, big, cite, code,
    del, dfn, em, img, ins, kbd, q, s, samp,
    small, strike, strong, sub, sup, tt, var,
    b, u, i, center,
    dl, dt, dd, ol, ul, li,
    fieldset, form, label, legend,
    table, caption, tbody, tfoot, thead, tr, th, td,
    article, aside, canvas, details, embed,
    figure, figcaption, footer, header, hgroup,
    menu, nav, output, ruby, section, summary,
    time, mark, audio, video {
        margin: 0;
        padding: 0;
        /*border: 0;*/
        font-size: 100%;
        font: inherit;
        vertical-align: baseline;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);   /** Disable orange highlight */
    }


</style>
        <script>
         

            $(document)
                .ready(function () {
                document.addEventListener("deviceready", systemReady, true);

            });

        	 var loadFailCounter =0;
            function renderWhenDone(type) {
                if (loaded == true) {
                    ////console.log("LOADED! " + type);
                    setTimeout(window["renderDetails"](0,type,null), 1000);
                    window.clearInterval(intervalVar);
                    $('#loading').hide();
                    loadFailCounter=0;
                    
                } else {
                	loadFailCounter = loadFailCounter+1;
                    ////console.log("NOT LOADED YET");
                    if(loadFailCounter>100)
                    	{
                    	loaded=true;
           	        	navigator.notification.alert("Problem fetching data from the server. Please check your network connection and try again", null, "Network Error", "Ok");
                    	}
                }

            }

            var db;
            var platform;
            function systemReady() {
               // platform = devicePlatform();
                platform = 'Android';

                if(platform == 'Android'){
            	document.addEventListener("click", onClickCall, true);
            	document.addEventListener("touchend", onClickCallTouch, true);
                document.addEventListener("menubutton", menuKeyDown, true);
                document.addEventListener("backbutton", backButton, true);
                }
                //registerPush();
                document.addEventListener("online", onOnline, false);
                document.addEventListener("offline", onOffline, false);
                //upgrade = window.localStorage.getItem('upgrade');
                upgrade = window.localStorage.getItem('upgrade4');
                
                //upgrade=true;
              	
                     rootView = {
                        title: "Better Islam Q&A",
                        view: $("<div id='rootView' style='background-color: #F5F5F5;'><div class='activityIndicator'></div></div>"),
                        tabs:"Y",
                        category:"%"
                    };

                     
                if (upgrade != "false") {
                    //console.log("DATA CLEARED");
                    var rateApp = window.localStorage.getItem('rateApp');
                    var questionsLoaded = window.localStorage.getItem('questionsLoaded');
                    var answers1Loaded = window.localStorage.getItem('answers1Loaded');
                    var syncId = window.localStorage.getItem('syncId');
                    var syncId = 0;
                    window.localStorage.clear();
                    window.localStorage.setItem('rateApp', rateApp);
                    window.localStorage.setItem('questionsLoaded', questionsLoaded);
                    window.localStorage.setItem('answers1Loaded', answers1Loaded);
                    if(syncId==''||syncId==undefined||syncId==null){
                        //SET APP VERSION HERE WHILE LAUNCH
                        window.localStorage.setItem('syncId', 0);
                    }
                    else{
                    window.localStorage.setItem('syncId', syncId);
                    }

                    //createDB(); 
                    renderImportDatabase();
                } else {
                    //console.log("DATA NOT CLEARED");
                    db = window.openDatabase("assim", "1.0", "Question and Answers Db", 100000000);
                renderCategories();
                }

                window.RightViewNavigator = new ViewNavigator('#body','header',null,null);
                window.RightViewNavigator.pushView(rootView);
                window.RightViewNavigator.resetScroller();

            }
            var menuState = "closed";
            //Fixes double click issue with nexus
        	var last_click_time = new Date().getTime();            
            function onClickCall(e)
            {
            	if(window.device != null && window.device.platform == "Android"){
                    //parse out dots so we can compare to earliest Jelly Bean version (410 without dots)
//                    //console.log("VERSION IS"+window.device.version.replace(/\./g,""));
                    var version = window.device.version.replace(/\./g,"");
                    version = parseInt(version);
                    if(version<100){
                    	version=version*100;
                    }

                    if(version >= 410){
		          	    click_time = e['timeStamp'];
		          	    if (click_time && (click_time - last_click_time) < 1000) {
		          	        e.stopImmediatePropagation();
		          	        e.preventDefault();
		          	        return false;
		          	    }
		          	    last_click_time = click_time;
		          	    }
            }
            }
            
           var last_click_time_touch = new Date().getTime();            
            function onClickCallTouch(e)
            {
            	if(window.device != null && window.device.platform == "Android"){
                    //parse out dots so we can compare to earliest Jelly Bean version (410 without dots)
//                    //console.log("VERSION IS"+window.device.version.replace(/\./g,""));
                    var version = window.device.version.replace(/\./g,"");
                    version = parseInt(version);
                    if(version<100){
                    	version=version*100;
                    }

                    if(version >= 410){
		          	    click_time = e['timeStamp'];
		          	    if (click_time && (click_time - last_click_time_touch) < 1000) {
		          	        e.stopImmediatePropagation();
		          	        e.preventDefault();
		          	        return false;
		          	    }
		          	  last_click_time_touch = click_time;
		          	    }
            }
            }

           
        </script>
    </head>
    
    <body ontouchstart="">
    <div class="alert" id="alert1">
        <!-- The top margin must be set to 50% of the alert's height using JavaScript. -->
        <div class="alert-content" style="margin-top: -85px;">
            <h3>Importing Questions</h3>
            <p>This could take a few minutes.</p>
            <p><strong id='progUpdateQ'></strong></p>
            <div class="progress" id="progressQ"><span class="blue" style="width: 1%"><span>0%</span></span></div>
            <!--<input type="text" class="alert-text-input" placeholder="password">-->
            <div class="alert-buttons" id="alertBt1">
                <a href="#" class="alert-button right primary" onclick="createDB()">Start</a>
                <a href="#" class="alert-button left" onclick="hideAlert();">Cancel</a>
            </div>
        </div>
    </div>
    <div class="alert" id="alert2">
        <div class="alert-content" style="margin-top: -85px;">
            <h3>Importing Answers Part 1</h3>
            <p>This could take a few minutes.</p>
            <p><strong id='progUpdateA1'></strong></p>
            <div class="progress" id="progressA1"><span class="blue" style="width: 1%"><span>0%</span></span></div>
            <!--<input type="text" class="alert-text-input" placeholder="password">-->
            <div class="alert-buttons" id="alertBt2">
                <a href="#" class="alert-button right primary" onclick="loadAnsw(1)">Start</a>
                <a href="#" class="alert-button left" onclick="hideAlert();">Cancel</a>
            </div>
        </div>
    </div>
    <div class="alert" id="alert3">
    <div class="alert-content" style="margin-top: -85px;">
            <h3>Importing Answers Part 2</h3>
            <p>This could take a few minutes.</p>
            <p><strong id='progUpdateA2'></strong></p>
            <div class="progress" id="progressA2"><span class="blue" style="width: 1%"><span>0%</span></span></div>
            <!--<input type="text" class="alert-text-input" placeholder="password">-->
            <div class="alert-buttons" id="alertBt3">
                <a href="#" class="alert-button right primary" onclick="loadAnsw(2)">Start</a>
                <a href="#" class="alert-button left" onclick="hideAlert();">Cancel</a>
            </div>
        </div>
    </div>

    <div class="alert" id="searchAlert">
        <!-- The top margin must be set to 50% of the alert's height using JavaScript. -->

        <div class="alert-content" style="margin-top: -85px;">
            <h3>Search IslamQA</h3>
            <p>Enter your search term:</p>
            <form action="#" onsubmit="return doSearchNow();">
            <input type="text" class="alert-text-input" placeholder="Search..." id="searchPut"></form>
            <div class="alert-buttons">
                <a href="#" class="alert-button right primary" onclick="doSearchNow();">Search</a>
                <a href="#" class="alert-button left" onclick="hideAlert();">Cancel</a>
            </div>
        </div>

    </div>

    <div class="alert" id="updateAlert">
        <div class="alert-content" style="margin-top: -85px;">
            <h3>Press Start to Check for Update</h3>
            <p>This could take a few minutes.</p>
            <p><strong id='progUpdateU1'></strong></p>
            <div class="progress" id="progressU1"><span id="prog" class="blue" style="width: 1%"><span>0%</span></span></div>
            <!--<input type="text" class="alert-text-input" placeholder="password">-->
            <div class="alert-buttons" id="alertBt4">
                <a href="#" class="alert-button right primary" onclick="checkForUpdate()">Start</a>
                <a href="#" class="alert-button left" onclick="hideAlert();">Cancel</a>
            </div>
        </div>
    </div>

    <div id="loading" style="display:none;">
            <img id="loading-image" src="img/ajax-loader.gif" alt="Loading..." />
        </div>
        <div class="slidingview_wrapper">
            <div id="sidebar"></div>
            <div id="bg">
                <div id="body"></div>
            </div>
        </div>
    </body>
          <script>//systemReady();
          </script>
</html>