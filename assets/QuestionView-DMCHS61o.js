import{r as h,v as $,s as B,e as k,l as t,i as v,t as _,n as E,p as M,F as N,m as P,w as A,j as z,M as D,D as F,k as V,o as p,f as j,B as H}from"./vendor-goXqKlOD.js";import{a as J,u as G,b as U,_ as b}from"./index-C2EJApSe.js";import{_ as W}from"./Button-CKwyDI4h.js";import{s as Y}from"./sharing-C8lTFykI.js";function K(n){if(!n)return[];const u=new Set,l=/islamqa\.info\/en\/answers\/(\d+)/g;let a;for(;(a=l.exec(n))!==null;)u.add(parseInt(a[1]));const s=/\/en\/answers\/(\d+)/g;for(;(a=s.exec(n))!==null;)u.add(parseInt(a[1]));return Array.from(u)}async function X(n,u,l,a=5){const g=K(n).filter(i=>i!==l).slice(0,a),d=[];for(const i of g)try{const f=await u(i);f&&d.push(f)}catch(f){console.warn(`Failed to load related question ${i}:`,f)}return d}function Z(n){if(!n)return null;const u=/\/(en|ar)\/answers\/(\d+)/,l=n.match(u);if(l){const r=parseInt(l[2],10);return console.log(`ðŸ“ Extracted question reference ${r} from answer URL: ${n}`),r}const a=/\/question\/(\d+)/,s=n.match(a);if(s){const r=parseInt(s[1],10);return console.log(`ðŸ“ Extracted question reference ${r} from question URL: ${n}`),r}return null}function ee(n){return n.startsWith("#")}function te(n){if(!n)return"";const l=new DOMParser().parseFromString(n,"text/html");return l.querySelectorAll("a").forEach(s=>{const r=s.getAttribute("href");if(!r)return;if(ee(r)){const d=r.substring(1);s.setAttribute("data-toc-anchor",d),s.setAttribute("href","javascript:void(0)"),s.style.cursor="pointer",s.classList.add("toc-link"),s.setAttribute("data-toc-link","true"),console.log(`ðŸ“Œ Converted TOC link: #${d}`);return}const g=Z(r);if(g!==null){s.setAttribute("href",`/#/question/${g}`),s.classList.add("internal-link"),s.removeAttribute("target"),console.log(`ðŸ”— Converted link: ${r} â†’ /#/question/${g}`);return}s.classList.add("external-link"),s.setAttribute("target","_blank"),s.setAttribute("rel","noopener noreferrer")}),l.body.innerHTML}const oe={class:"question-view h-full flex flex-col bg-neutral-50 dark:bg-neutral-950"},re={class:"bg-gradient-to-r from-primary-600 to-primary-800 dark:from-primary-700 dark:to-primary-900 text-white p-3 sm:p-4 shadow flex items-center"},se={class:"flex-1"},ne={class:"text-primary-100 dark:text-primary-200 text-sm"},ae={class:"flex items-center gap-2"},le={class:"flex-1 overflow-y-auto p-4"},ie={key:0,class:"flex items-center justify-center h-64"},ce={key:1,class:"space-y-6"},ue={class:"bg-white dark:bg-neutral-900 rounded-lg shadow dark:shadow-neutral-900/50 p-6"},de={class:"text-2xl font-bold text-neutral-900 dark:text-neutral-100 mb-4"},fe=["innerHTML"],me={class:"bg-white dark:bg-neutral-900 rounded-lg shadow dark:shadow-neutral-900/50 p-6"},pe=["innerHTML"],ge={key:0,class:"bg-primary-50 dark:bg-primary-900/20 rounded-lg p-6"},he={key:0,class:"flex items-center justify-center py-4"},ke={key:1,class:"space-y-3"},xe={class:"flex items-start"},ve={class:"flex-1"},be={class:"font-medium text-neutral-900 dark:text-neutral-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors line-clamp-2"},we={class:"text-xs text-neutral-500 dark:text-neutral-400 mt-1"},ye={key:2,class:"text-center py-12"},_e={class:"w-20 h-20 bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center mx-auto mb-4"},qe={__name:"QuestionView",setup(n){const u=F(),l=z(),a=G(),s=U(),r=h(null);h(null);const g=h(""),d=h(!1),i=h(!1),f=h([]),w=h(!1),q=h(null);function I(o){if(!o)return;const e=o.querySelectorAll('a[data-toc-link], a.toc-link, a[href^="#"]');console.log(`ðŸ“ Found ${e.length} TOC links`),e.forEach(m=>{m.addEventListener("click",x=>{const c=m.getAttribute("data-toc-anchor");if(!c)return;console.log(`ðŸ–±ï¸  TOC link clicked for anchor: ${c}`),x.preventDefault(),x.stopImmediatePropagation();const S=document.getElementById(c);if(S){console.log("âœ… Scrolling to TOC section:",c);const O=S.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:O,behavior:"smooth"})}else{console.warn("âŒ TOC target not found:",c);const Q=Array.from(document.querySelectorAll("[id]")).map(y=>y.id);console.warn("Available IDs:",Q.filter(y=>y.toLowerCase().includes(c.toLowerCase())))}},!0)})}async function C(){try{d.value=!0;const o=l.params.id;console.log("Loading question:",o);const e=await a.getQuestion(o);console.log("Question loaded:",e),r.value=e,e&&e.answer&&(g.value=te(e.answer)),e&&s.readQuestion(e.reference);const m=JSON.parse(localStorage.getItem("bookmarks")||"[]");if(i.value=m.includes(parseInt(o)),e&&e.answer){w.value=!0;try{f.value=await X(e.answer,a.getQuestion.bind(a),e.reference,5),console.log("Related questions loaded:",f.value.length)}catch(x){console.error("Error loading related questions:",x)}finally{w.value=!1}}await D(),q.value&&(I(q.value),console.log("TOC link handlers setup complete"))}catch(o){console.error("Error loading question:",o)}finally{d.value=!1}}$(()=>{C()}),B(()=>l.params.id,(o,e)=>{o&&o!==e&&(window.scrollTo({top:0,behavior:"smooth"}),C())});function L(){u.back()}function T(){if(!r.value)return;const o=JSON.parse(localStorage.getItem("bookmarks")||"[]"),e=r.value.reference;if(i.value){const m=o.indexOf(e);m>-1&&o.splice(m,1)}else o.push(e),s.createBookmark();i.value=!i.value,localStorage.setItem("bookmarks",JSON.stringify(o)),localStorage.setItem("bookmarkCount",o.length.toString()),console.log("Bookmark toggled:",i.value)}async function R(){if(r.value)try{const o=await Y(r.value);o.success&&o.platform==="clipboard"&&alert(o.message||"Copied to clipboard!")}catch(o){console.error("Error sharing question:",o),o.cancelled||alert("Failed to share question. Please try again.")}}return(o,e)=>{var x;const m=V("router-link");return p(),k("div",oe,[t("header",re,[t("button",{onClick:L,class:"mr-3 text-2xl hover:opacity-80 transition-opacity"},[v(b,{name:"arrowLeft",size:"md"})]),t("div",se,[e[0]||(e[0]=t("h1",{class:"text-base sm:text-lg font-bold"},"Question",-1)),t("p",ne,"Q#"+_((x=r.value)==null?void 0:x.reference),1)]),t("div",ae,[t("button",{onClick:R,class:"p-2 hover:bg-white/10 rounded-lg transition-colors"},[v(b,{name:"share",size:"lg",class:"text-white"})]),t("button",{onClick:T,class:"p-2 hover:bg-white/10 rounded-lg transition-colors"},[v(b,{name:i.value?"bookmarkSolid":"bookmark",size:"lg",class:E(i.value?"text-accent-400":"text-white")},null,8,["name","class"])])])]),t("div",le,[d.value?(p(),k("div",ie,[...e[1]||(e[1]=[t("div",{class:"text-center"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 dark:border-primary-400 mx-auto"}),t("p",{class:"mt-4 text-neutral-600 dark:text-neutral-400"},"Loading question...")],-1)])])):r.value?(p(),k("div",ce,[t("div",ue,[t("h2",de,_(r.value.title),1),t("div",{class:"prose prose-sm dark:prose-invert max-w-none text-neutral-600 dark:text-neutral-400",innerHTML:r.value.question},null,8,fe)]),t("div",me,[e[2]||(e[2]=t("h3",{class:"text-xl font-semibold text-neutral-900 dark:text-neutral-100 mb-4"},"Answer",-1)),t("div",{ref_key:"answerContainer",ref:q,class:"prose prose-sm dark:prose-invert max-w-none text-neutral-700 dark:text-neutral-300",innerHTML:g.value},null,8,pe)]),f.value.length>0||w.value?(p(),k("div",ge,[e[4]||(e[4]=t("h3",{class:"text-base sm:text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-4"},"Related Questions",-1)),w.value?(p(),k("div",he,[...e[3]||(e[3]=[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 dark:border-primary-400"},null,-1)])])):(p(),k("div",ke,[(p(!0),k(N,null,P(f.value,c=>(p(),j(m,{key:c.reference,to:`/question/${c.reference}`,class:"block p-4 bg-white dark:bg-neutral-800 rounded-lg hover:shadow-md dark:hover:shadow-neutral-900/50 transition-all group"},{default:A(()=>[t("div",xe,[t("div",ve,[t("h4",be,_(c.title),1),t("p",we,"Q#"+_(c.reference),1)]),v(b,{name:"arrowRight",size:"sm",class:"text-neutral-400 dark:text-neutral-600 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors ml-2 mt-1"})])]),_:2},1032,["to"]))),128))]))])):M("",!0)])):(p(),k("div",ye,[t("div",_e,[v(b,{name:"xCircle",size:"xl",class:"text-neutral-400 dark:text-neutral-600"})]),e[6]||(e[6]=t("h3",{class:"text-base sm:text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-2"},"Question Not Found",-1)),e[7]||(e[7]=t("p",{class:"text-neutral-600 dark:text-neutral-400 mb-6"},"This question could not be loaded",-1)),v(W,{variant:"primary",size:"lg",onClick:L},{default:A(()=>[...e[5]||(e[5]=[H(" Go Back ",-1)])]),_:1})]))])])}}},Ae=J(qe,[["__scopeId","data-v-a38b3c2b"]]);export{Ae as default};
