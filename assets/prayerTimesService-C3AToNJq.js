var ht=Object.defineProperty;var ct=(s,e,t)=>e in s?ht(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var I=(s,e,t)=>ct(s,typeof e!="symbol"?e+"":e,t);const H={Shafi:"shafi",Hanafi:"hanafi"};function ut(s){switch(s){case H.Shafi:return 1;case H.Hanafi:return 2;default:throw"Invalid Madhab"}}const b={MiddleOfTheNight:"middleofthenight",SeventhOfTheNight:"seventhofthenight",TwilightAngle:"twilightangle"};class q{constructor(e,t){this.latitude=e,this.longitude=t}}const k={Nearest:"nearest",Up:"up",None:"none"};function F(s,e){const t=s.getFullYear(),n=s.getMonth(),r=s.getDate()+e,i=s.getHours(),o=s.getMinutes(),a=s.getSeconds();return new Date(t,n,r,i,o,a)}function O(s,e){return E(s,e*60)}function E(s,e){return new Date(s.getTime()+e*1e3)}function j(s,e=k.Nearest){const t=s.getUTCSeconds();let n=t>=30?60-t:-1*t;return e===k.Up?n=60-t:e===k.None&&(n=0),E(s,n)}function Z(s){let e=0;const n=[31,d.isLeapYear(s.getFullYear())?29:28,31,30,31,30,31,31,30,31,30,31];for(let r=0;r<s.getMonth();r++)e+=n[r];return e+=s.getDate(),e}function tt(s){return s instanceof Date&&!isNaN(s.valueOf())}function l(s){return s*Math.PI/180}function R(s){return s*180/Math.PI}function et(s,e){return s-e*Math.floor(s/e)}function T(s){return et(s,360)}function lt(s){return s>=-180&&s<=180?s:s-360*Math.round(s/360)}const V={General:"general",Ahmer:"ahmer",Abyad:"abyad"},d={meanSolarLongitude(s){const e=s,t=280.4664567,n=36000.76983*e,r=3032e-7*Math.pow(e,2),i=t+n+r;return T(i)},meanLunarLongitude(s){const e=s,t=218.3165,n=481267.8813*e,r=t+n;return T(r)},ascendingLunarNodeLongitude(s){const e=s,t=125.04452,n=1934.136261*e,r=.0020708*Math.pow(e,2),i=Math.pow(e,3)/45e4,o=t-n+r+i;return T(o)},meanSolarAnomaly(s){const e=s,t=357.52911,n=35999.05029*e,r=1537e-7*Math.pow(e,2),i=t+n-r;return T(i)},solarEquationOfTheCenter(s,e){const t=s,n=l(e),r=(1.914602-.004817*t-14e-6*Math.pow(t,2))*Math.sin(n),i=(.019993-101e-6*t)*Math.sin(2*n),o=289e-6*Math.sin(3*n);return r+i+o},apparentSolarLongitude(s,e){const t=s,r=e+d.solarEquationOfTheCenter(t,d.meanSolarAnomaly(t)),i=125.04-1934.136*t,o=r-.00569-.00478*Math.sin(l(i));return T(o)},meanObliquityOfTheEcliptic(s){const e=s,t=23.439291,n=.013004167*e,r=1639e-10*Math.pow(e,2),i=5036e-10*Math.pow(e,3);return t-n-r+i},apparentObliquityOfTheEcliptic(s,e){const t=s,n=e,r=125.04-1934.136*t;return n+.00256*Math.cos(l(r))},meanSiderealTime(s){const e=s,t=e*36525+2451545,n=280.46061837,r=360.98564736629*(t-2451545),i=387933e-9*Math.pow(e,2),o=Math.pow(e,3)/3871e4,a=n+r+i-o;return T(a)},nutationInLongitude(s,e,t,n){const r=e,i=t,o=n,a=-17.2/3600*Math.sin(l(o)),u=1.32/3600*Math.sin(2*l(r)),h=.23/3600*Math.sin(2*l(i)),m=.21/3600*Math.sin(2*l(o));return a-u-h+m},nutationInObliquity(s,e,t,n){const r=e,i=t,o=n,a=9.2/3600*Math.cos(l(o)),u=.57/3600*Math.cos(2*l(r)),h=.1/3600*Math.cos(2*l(i)),m=.09/3600*Math.cos(2*l(o));return a+u+h-m},altitudeOfCelestialBody(s,e,t){const n=s,r=e,i=t,o=Math.sin(l(n))*Math.sin(l(r)),a=Math.cos(l(n))*Math.cos(l(r))*Math.cos(l(i));return R(Math.asin(o+a))},approximateTransit(s,e,t){const n=s,r=e,i=t,o=n*-1;return et((i+o-r)/360,1)},correctedTransit(s,e,t,n,r,i){const o=s,a=e,u=t,h=n,m=r,g=i,f=a*-1,y=T(u+360.985647*o),D=T(d.interpolateAngles(h,m,g,o)),C=lt(y-f-D)/-360;return(o+C)*24},correctedHourAngle(s,e,t,n,r,i,o,a,u,h,m){const g=s,f=e,y=r,D=i,v=o,C=a,L=u,G=h,K=m,B=t.longitude*-1,Q=Math.sin(l(f))-Math.sin(l(t.latitude))*Math.sin(l(L)),z=Math.cos(l(t.latitude))*Math.cos(l(L)),W=R(Math.acos(Q/z)),P=n?g+W/360:g-W/360,w=T(y+360.985647*P),_=T(d.interpolateAngles(D,v,C,P)),J=d.interpolate(L,G,K,P),X=w-B-_,it=d.altitudeOfCelestialBody(t.latitude,J,X)-f,ot=360*Math.cos(l(J))*Math.cos(l(t.latitude))*Math.sin(l(X)),at=it/ot;return(P+at)*24},interpolate(s,e,t,n){const r=s-e,i=t-s,o=i-r;return s+n/2*(r+i+n*o)},interpolateAngles(s,e,t,n){const r=T(s-e),i=T(t-s),o=i-r;return s+n/2*(r+i+n*o)},julianDay(s,e,t,n=0){const r=Math.trunc,i=r(e>2?s:s-1),o=r(e>2?e:e+12),a=t+n/24,u=r(i/100),h=r(2-u+r(u/4)),m=r(365.25*(i+4716)),g=r(30.6001*(o+1));return m+g+a+h-1524.5},julianCentury(s){return(s-2451545)/36525},isLeapYear(s){return!(s%4!==0||s%100===0&&s%400!==0)},seasonAdjustedMorningTwilight(s,e,t,n){const r=75+.5209090909090909*Math.abs(s),i=75+19.44/55*Math.abs(s),o=75+32.74/55*Math.abs(s),a=75+48.1/55*Math.abs(s),u=function(){const h=d.daysSinceSolstice(e,t,s);return h<91?r+(i-r)/91*h:h<137?i+(o-i)/46*(h-91):h<183?o+(a-o)/46*(h-137):h<229?a+(o-a)/46*(h-183):h<275?o+(i-o)/46*(h-229):i+(r-i)/91*(h-275)}();return E(n,Math.round(u*-60))},seasonAdjustedEveningTwilight(s,e,t,n,r){let i,o,a,u;r===V.Ahmer?(i=62+17.4/55*Math.abs(s),o=62-7.16/55*Math.abs(s),a=62+5.12/55*Math.abs(s),u=62+19.44/55*Math.abs(s)):r===V.Abyad?(i=75+25.6/55*Math.abs(s),o=75+7.16/55*Math.abs(s),a=75+36.84/55*Math.abs(s),u=75+81.84/55*Math.abs(s)):(i=75+25.6/55*Math.abs(s),o=75+2.05/55*Math.abs(s),a=75-9.21/55*Math.abs(s),u=75+6.14/55*Math.abs(s));const h=function(){const m=d.daysSinceSolstice(e,t,s);return m<91?i+(o-i)/91*m:m<137?o+(a-o)/46*(m-91):m<183?a+(u-a)/46*(m-137):m<229?u+(a-u)/46*(m-183):m<275?a+(o-a)/46*(m-229):o+(i-o)/91*(m-275)}();return E(n,Math.round(h*60))},daysSinceSolstice(s,e,t){let n=0;const r=10,i=d.isLeapYear(e)?173:172,o=d.isLeapYear(e)?366:365;return t>=0?(n=s+r,n>=o&&(n=n-o)):(n=s-i,n<0&&(n=n+o)),n}};class ${constructor(e){const t=d.julianCentury(e),n=d.meanSolarLongitude(t),r=d.meanLunarLongitude(t),i=d.ascendingLunarNodeLongitude(t),o=l(d.apparentSolarLongitude(t,n)),a=d.meanSiderealTime(t),u=d.nutationInLongitude(t,n,r,i),h=d.nutationInObliquity(t,n,r,i),m=d.meanObliquityOfTheEcliptic(t),g=l(d.apparentObliquityOfTheEcliptic(t,m));this.declination=R(Math.asin(Math.sin(g)*Math.sin(o))),this.rightAscension=T(R(Math.atan2(Math.cos(g)*Math.sin(o),Math.cos(o)))),this.apparentSiderealTime=a+u*3600*Math.cos(l(m+h))/3600}}class N{constructor(e,t){const n=d.julianDay(e.getFullYear(),e.getMonth()+1,e.getDate(),0);this.observer=t,this.solar=new $(n),this.prevSolar=new $(n-1),this.nextSolar=new $(n+1);const r=d.approximateTransit(t.longitude,this.solar.apparentSiderealTime,this.solar.rightAscension),i=-50/60;this.approxTransit=r,this.transit=d.correctedTransit(r,t.longitude,this.solar.apparentSiderealTime,this.solar.rightAscension,this.prevSolar.rightAscension,this.nextSolar.rightAscension),this.sunrise=d.correctedHourAngle(r,i,t,!1,this.solar.apparentSiderealTime,this.solar.rightAscension,this.prevSolar.rightAscension,this.nextSolar.rightAscension,this.solar.declination,this.prevSolar.declination,this.nextSolar.declination),this.sunset=d.correctedHourAngle(r,i,t,!0,this.solar.apparentSiderealTime,this.solar.rightAscension,this.prevSolar.rightAscension,this.nextSolar.rightAscension,this.solar.declination,this.prevSolar.declination,this.nextSolar.declination)}hourAngle(e,t){return d.correctedHourAngle(this.approxTransit,e,this.observer,t,this.solar.apparentSiderealTime,this.solar.rightAscension,this.prevSolar.rightAscension,this.nextSolar.rightAscension,this.solar.declination,this.prevSolar.declination,this.nextSolar.declination)}afternoon(e){const t=Math.abs(this.observer.latitude-this.solar.declination),n=e+Math.tan(l(t)),r=R(Math.atan(1/n));return this.hourAngle(r,!0)}}const Y={AqrabBalad:"AqrabBalad",AqrabYaum:"AqrabYaum",Unresolved:"Unresolved"},nt=.5,mt=65,x=s=>!isNaN(s.sunrise)&&!isNaN(s.sunset),st=(s,e,t=1,n=1)=>{if(t>Math.ceil(365/2))return null;const r=new Date(e.getTime());r.setDate(r.getDate()+n*t);const i=F(r,1),o=new N(r,s),a=new N(i,s);return!x(o)||!x(a)?st(s,e,t+(n>0?0:1),-n):{date:e,tomorrow:i,coordinates:s,solarTime:o,tomorrowSolarTime:a}},rt=(s,e,t)=>{const n=new N(e,{...s,latitude:t}),r=F(e,1),i=new N(r,{...s,latitude:t});return!x(n)||!x(i)?Math.abs(t)>=mt?rt(s,e,t-Math.sign(t)*nt):null:{date:e,tomorrow:r,coordinates:new q(t,s.longitude),solarTime:n,tomorrowSolarTime:i}},dt=(s,e,t)=>{const n={date:e,tomorrow:F(e,1),coordinates:t,solarTime:new N(e,t),tomorrowSolarTime:new N(F(e,1),t)};switch(s){case Y.AqrabYaum:return st(t,e)||n;case Y.AqrabBalad:{const{latitude:r}=t;return rt(t,e,r-Math.sign(r)*nt)||n}default:return n}};class M{constructor(e,t=0,n=0,r=0,i=0){I(this,"madhab",H.Shafi);I(this,"highLatitudeRule",b.MiddleOfTheNight);I(this,"adjustments",{fajr:0,sunrise:0,dhuhr:0,asr:0,maghrib:0,isha:0});I(this,"methodAdjustments",{fajr:0,sunrise:0,dhuhr:0,asr:0,maghrib:0,isha:0});I(this,"polarCircleResolution",Y.Unresolved);I(this,"rounding",k.Nearest);I(this,"shafaq",V.General);this.method=e,this.fajrAngle=t,this.ishaAngle=n,this.ishaInterval=r,this.maghribAngle=i,this.method===null&&(this.method="Other")}nightPortions(){switch(this.highLatitudeRule){case b.MiddleOfTheNight:return{fajr:1/2,isha:1/2};case b.SeventhOfTheNight:return{fajr:1/7,isha:1/7};case b.TwilightAngle:return{fajr:this.fajrAngle/60,isha:this.ishaAngle/60};default:throw`Invalid high latitude rule found when attempting to compute night portions: ${this.highLatitudeRule}`}}}const p={MuslimWorldLeague(){const s=new M("MuslimWorldLeague",18,17);return s.methodAdjustments.dhuhr=1,s},Egyptian(){const s=new M("Egyptian",19.5,17.5);return s.methodAdjustments.dhuhr=1,s},Karachi(){const s=new M("Karachi",18,18);return s.methodAdjustments.dhuhr=1,s},UmmAlQura(){return new M("UmmAlQura",18.5,0,90)},Dubai(){const s=new M("Dubai",18.2,18.2);return s.methodAdjustments={...s.methodAdjustments,sunrise:-3,dhuhr:3,asr:3,maghrib:3},s},MoonsightingCommittee(){const s=new M("MoonsightingCommittee",18,18);return s.methodAdjustments={...s.methodAdjustments,dhuhr:5,maghrib:3},s},NorthAmerica(){const s=new M("NorthAmerica",15,15);return s.methodAdjustments.dhuhr=1,s},Kuwait(){return new M("Kuwait",18,17.5)},Qatar(){return new M("Qatar",18,0,90)},Singapore(){const s=new M("Singapore",20,18);return s.methodAdjustments.dhuhr=1,s.rounding=k.Up,s},Tehran(){return new M("Tehran",17.7,14,0,4.5)},Turkey(){const s=new M("Turkey",18,17);return s.methodAdjustments={...s.methodAdjustments,sunrise:-7,dhuhr:5,asr:4,maghrib:7},s},Other(){return new M("Other",0,0)}},c={Fajr:"fajr",Sunrise:"sunrise",Dhuhr:"dhuhr",Asr:"asr",Maghrib:"maghrib",Isha:"isha",None:"none"};class S{constructor(e){return this.hours=Math.floor(e),this.minutes=Math.floor((e-this.hours)*60),this.seconds=Math.floor((e-(this.hours+this.minutes/60))*60*60),this}utcDate(e,t,n){return new Date(Date.UTC(e,t,n,this.hours,this.minutes,this.seconds))}}class gt{constructor(e,t,n){this.coordinates=e,this.date=t,this.calculationParameters=n;let r=new N(t,e),i,o,a,u,h,m,g,f;a=new S(r.transit).utcDate(t.getFullYear(),t.getMonth(),t.getDate()),o=new S(r.sunrise).utcDate(t.getFullYear(),t.getMonth(),t.getDate()),h=new S(r.sunset).utcDate(t.getFullYear(),t.getMonth(),t.getDate());const y=F(t,1);let D=new N(y,e);const v=n.polarCircleResolution;if((!tt(o)||!tt(h)||isNaN(D.sunrise))&&v!==Y.Unresolved){const w=dt(v,t,e);r=w.solarTime,D=w.tomorrowSolarTime;const _=[t.getFullYear(),t.getMonth(),t.getDate()];a=new S(r.transit).utcDate(..._),o=new S(r.sunrise).utcDate(..._),h=new S(r.sunset).utcDate(..._)}u=new S(r.afternoon(ut(n.madhab))).utcDate(t.getFullYear(),t.getMonth(),t.getDate());const C=new S(D.sunrise).utcDate(y.getFullYear(),y.getMonth(),y.getDate()),L=(Number(C)-Number(h))/1e3;i=new S(r.hourAngle(-1*n.fajrAngle,!1)).utcDate(t.getFullYear(),t.getMonth(),t.getDate()),n.method==="MoonsightingCommittee"&&e.latitude>=55&&(f=L/7,i=E(o,-f));const G=function(){return n.method==="MoonsightingCommittee"?d.seasonAdjustedMorningTwilight(e.latitude,Z(t),t.getFullYear(),o):(f=n.nightPortions().fajr*L,E(o,-f))}();if((isNaN(i.getTime())||G>i)&&(i=G),n.ishaInterval>0)g=O(h,n.ishaInterval);else{g=new S(r.hourAngle(-1*n.ishaAngle,!0)).utcDate(t.getFullYear(),t.getMonth(),t.getDate()),n.method==="MoonsightingCommittee"&&e.latitude>=55&&(f=L/7,g=E(h,f));const w=function(){return n.method==="MoonsightingCommittee"?d.seasonAdjustedEveningTwilight(e.latitude,Z(t),t.getFullYear(),h,n.shafaq):(f=n.nightPortions().isha*L,E(h,f))}();(isNaN(g.getTime())||w<g)&&(g=w)}if(m=h,n.maghribAngle){const w=new S(r.hourAngle(-1*n.maghribAngle,!0)).utcDate(t.getFullYear(),t.getMonth(),t.getDate());h<w&&g>w&&(m=w)}const K=(n.adjustments.fajr||0)+(n.methodAdjustments.fajr||0),B=(n.adjustments.sunrise||0)+(n.methodAdjustments.sunrise||0),Q=(n.adjustments.dhuhr||0)+(n.methodAdjustments.dhuhr||0),z=(n.adjustments.asr||0)+(n.methodAdjustments.asr||0),W=(n.adjustments.maghrib||0)+(n.methodAdjustments.maghrib||0),P=(n.adjustments.isha||0)+(n.methodAdjustments.isha||0);this.fajr=j(O(i,K),n.rounding),this.sunrise=j(O(o,B),n.rounding),this.dhuhr=j(O(a,Q),n.rounding),this.asr=j(O(u,z),n.rounding),this.sunset=j(h,n.rounding),this.maghrib=j(O(m,W),n.rounding),this.isha=j(O(g,P),n.rounding)}timeForPrayer(e){return e===c.Fajr?this.fajr:e===c.Sunrise?this.sunrise:e===c.Dhuhr?this.dhuhr:e===c.Asr?this.asr:e===c.Maghrib?this.maghrib:e===c.Isha?this.isha:null}currentPrayer(e=new Date){return e>=this.isha?c.Isha:e>=this.maghrib?c.Maghrib:e>=this.asr?c.Asr:e>=this.dhuhr?c.Dhuhr:e>=this.sunrise?c.Sunrise:e>=this.fajr?c.Fajr:c.None}nextPrayer(e=new Date){return e>=this.isha?c.None:e>=this.maghrib?c.Isha:e>=this.asr?c.Maghrib:e>=this.dhuhr?c.Asr:e>=this.sunrise?c.Dhuhr:e>=this.fajr?c.Sunrise:c.Fajr}}function ft(s){const e=new q(21.4225241,39.8261818),t=Math.sin(l(e.longitude)-l(s.longitude)),n=Math.cos(l(s.latitude))*Math.tan(l(e.latitude)),r=Math.sin(l(s.latitude))*Math.cos(l(e.longitude)-l(s.longitude)),i=Math.atan2(t,n-r);return T(R(i))}class At{constructor(){var e,t;this.isCordova=!!window.cordova,this.diagnostic=this.isCordova?(t=(e=window.cordova)==null?void 0:e.plugins)==null?void 0:t.diagnostic:null}async isLocationAuthorized(){return this.isCordova?new Promise(e=>{if(!this.diagnostic){console.warn("Diagnostic plugin not available"),e(!1);return}this.diagnostic.getLocationAuthorizationStatus(t=>{const n=t===this.diagnostic.permissionStatus.GRANTED||t===this.diagnostic.permissionStatus.GRANTED_WHEN_IN_USE;console.log("[LocationPermission] Authorization status:",t,"Authorized:",n),e(n)},t=>{console.error("[LocationPermission] Error checking authorization:",t),e(!1)})}):!0}async getPermissionStatus(){return!this.isCordova||!this.diagnostic?{status:"unknown",canRequest:!0,shouldShowSettings:!1}:new Promise(e=>{this.diagnostic.getLocationAuthorizationStatus(t=>{const n=this.diagnostic.permissionStatus,r={status:t,canRequest:t===n.NOT_REQUESTED||t===n.DENIED_ONCE,shouldShowSettings:t===n.DENIED_ALWAYS,isGranted:t===n.GRANTED||t===n.GRANTED_WHEN_IN_USE,statusText:this.getStatusText(t)};console.log("[LocationPermission] Permission status:",r),e(r)},t=>{console.error("[LocationPermission] Error getting permission status:",t),e({status:"error",canRequest:!1,shouldShowSettings:!1,isGranted:!1,statusText:"Error checking permission"})})})}async requestPermission(){return!this.isCordova||!this.diagnostic?(console.log("[LocationPermission] Not Cordova or no diagnostic plugin, skipping request"),!0):new Promise(e=>{this.diagnostic.requestLocationAuthorization(t=>{const n=this.diagnostic.permissionStatus,r=t===n.GRANTED||t===n.GRANTED_WHEN_IN_USE;console.log("[LocationPermission] Permission request result:",t,"Granted:",r),e(r)},t=>{console.error("[LocationPermission] Error requesting permission:",t),e(!1)})})}async isLocationEnabled(){return!this.isCordova||!this.diagnostic?!0:new Promise(e=>{this.diagnostic.isLocationEnabled(t=>{console.log("[LocationPermission] Location services enabled:",t),e(t)},t=>{console.error("[LocationPermission] Error checking location services:",t),e(!1)})})}openDeviceSettings(){if(!this.isCordova||!this.diagnostic){console.warn("[LocationPermission] Cannot open settings (not Cordova or no diagnostic plugin)");return}this.diagnostic.switchToSettings(()=>{console.log("[LocationPermission] Opened device settings")},e=>{console.error("[LocationPermission] Error opening settings:",e)})}getStatusText(e){if(!this.diagnostic)return"Unknown";const t=this.diagnostic.permissionStatus;switch(e){case t.GRANTED:case t.GRANTED_WHEN_IN_USE:return"Granted";case t.NOT_REQUESTED:return"Not Requested";case t.DENIED_ONCE:return"Denied";case t.DENIED_ALWAYS:return"Permanently Denied";case t.RESTRICTED:return"Restricted";default:return"Unknown"}}async checkPermissionWithMessage(){const e=await this.getPermissionStatus();return e.isGranted?{hasPermission:!0,message:"Location permission granted"}:await this.isLocationEnabled()?e.shouldShowSettings?{hasPermission:!1,canRequest:!1,shouldShowSettings:!0,message:"Location permission was permanently denied. Please enable it in your device settings."}:e.canRequest?{hasPermission:!1,canRequest:!0,shouldShowSettings:!1,message:"Location permission is required to calculate accurate prayer times."}:{hasPermission:!1,canRequest:!1,shouldShowSettings:!1,message:"Location permission is not available."}:{hasPermission:!1,canRequest:!1,shouldShowSettings:!0,message:"Location services are disabled on your device. Please enable location services in your device settings."}}}const U=new At,A={LOCATION:"prayer_location",CALCULATION_METHOD:"prayer_calculation_method",MADHAB:"prayer_madhab",LOCATION_NAME:"prayer_location_name",HIGH_LATITUDE_RULE:"prayer_high_latitude_rule"},Tt={MUSLIM_WORLD_LEAGUE:{key:"MUSLIM_WORLD_LEAGUE",name:"Muslim World League",description:"Standard Fajr (18°) and Isha (17°)",regions:["Europe","Far East","Parts of America"]},EGYPTIAN:{key:"EGYPTIAN",name:"Egyptian General Authority",description:"Early Fajr (19.5°) and Isha (17.5°)",regions:["Africa","Syria","Lebanon","Malaysia"]},KARACHI:{key:"KARACHI",name:"University of Islamic Sciences, Karachi",description:"Standard angles (18°)",regions:["Pakistan","Bangladesh","India","Afghanistan"]},UMM_AL_QURA:{key:"UMM_AL_QURA",name:"Umm Al-Qura University, Makkah",description:"Fajr (18.5°), Isha 90 min after Maghrib",regions:["Saudi Arabia"],note:"Add 30 min to Isha during Ramadan"},DUBAI:{key:"DUBAI",name:"Dubai",description:"Fajr (18.2°) with offsets",regions:["United Arab Emirates"]},QATAR:{key:"QATAR",name:"Qatar",description:"Isha 90 min after Maghrib",regions:["Qatar"]},KUWAIT:{key:"KUWAIT",name:"Kuwait",description:"Fajr (18°), Isha (17.5°)",regions:["Kuwait"]},MOONSIGHTING_COMMITTEE:{key:"MOONSIGHTING_COMMITTEE",name:"Moonsighting Committee",description:"Standard angles with seasonal adjustments",regions:["North America","United Kingdom"]},SINGAPORE:{key:"SINGAPORE",name:"Singapore",description:"Early Fajr (20°), standard Isha (18°)",regions:["Singapore","Malaysia","Indonesia"]},TURKEY:{key:"TURKEY",name:"Turkey (Diyanet)",description:"Approximation of Diyanet method",regions:["Turkey"]},TEHRAN:{key:"TEHRAN",name:"Institute of Geophysics, Tehran",description:"Fajr (17.7°), Isha (14°)",regions:["Iran"]},NORTH_AMERICA:{key:"NORTH_AMERICA",name:"ISNA (North America)",description:"Later Fajr (15°) and early Isha (15°)",regions:["United States","Canada"]},KUWAIT_CUSTOM:{key:"KUWAIT_CUSTOM",name:"Kuwait (Custom)",description:"Custom Kuwait calculation",regions:["Kuwait"]}},Mt={SHAFI:{key:"SHAFI",name:"Shafi, Maliki, Hanbali",description:"Earlier Asr (shadow length = object + shadow)"},HANAFI:{key:"HANAFI",name:"Hanafi",description:"Later Asr (shadow length = 2x object + shadow)"}},pt={MIDDLE_OF_NIGHT:{key:"MIDDLE_OF_NIGHT",name:"Middle of the Night",description:"Fajr/Isha calculated from middle of night"},SEVENTH_OF_NIGHT:{key:"SEVENTH_OF_NIGHT",name:"Seventh of the Night",description:"Fajr/Isha calculated from 1/7 of night"},TWILIGHT_ANGLE:{key:"TWILIGHT_ANGLE",name:"Twilight Angle",description:"Use twilight angle (default)"}};class wt{constructor(){this.location=this.loadLocation(),this.calculationMethod=this.loadCalculationMethod(),this.madhab=this.loadMadhab(),this.locationName=this.loadLocationName(),this.highLatitudeRule=this.loadHighLatitudeRule()}loadLocation(){const e=localStorage.getItem(A.LOCATION);if(e)try{const{latitude:t,longitude:n}=JSON.parse(e);return{latitude:t,longitude:n}}catch(t){console.error("Failed to parse stored location:",t)}return null}saveLocation(e,t,n=null){localStorage.setItem(A.LOCATION,JSON.stringify({latitude:e,longitude:t})),n&&(localStorage.setItem(A.LOCATION_NAME,n),this.locationName=n),this.location={latitude:e,longitude:t}}loadLocationName(){return localStorage.getItem(A.LOCATION_NAME)||"Unknown Location"}loadCalculationMethod(){return localStorage.getItem(A.CALCULATION_METHOD)||"UMM_AL_QURA"}saveCalculationMethod(e){localStorage.setItem(A.CALCULATION_METHOD,e),this.calculationMethod=e}loadMadhab(){return localStorage.getItem(A.MADHAB)||"HANAFI"}saveMadhab(e){localStorage.setItem(A.MADHAB,e),this.madhab=e}loadHighLatitudeRule(){return localStorage.getItem(A.HIGH_LATITUDE_RULE)||"MIDDLE_OF_NIGHT"}saveHighLatitudeRule(e){localStorage.setItem(A.HIGH_LATITUDE_RULE,e),this.highLatitudeRule=e}async detectLocation(e=!1){if(!e&&window.cordova){const t=await U.checkPermissionWithMessage();if(!t.hasPermission)if(t.canRequest){if(!await U.requestPermission()){const r=new Error(t.message);throw r.permissionDenied=!0,r.shouldShowSettings=!1,r}}else{const n=new Error(t.message);throw n.permissionDenied=!0,n.shouldShowSettings=t.shouldShowSettings,n}}return new Promise((t,n)=>{if(!navigator.geolocation){n(new Error("Geolocation is not supported by your device"));return}navigator.geolocation.getCurrentPosition(async r=>{const i=r.coords.latitude,o=r.coords.longitude;let a="Current Location";try{a=await this.reverseGeocode(i,o)}catch(u){console.warn("Could not get location name:",u)}this.saveLocation(i,o,a),t({latitude:i,longitude:o,locationName:a,permissionDenied:!1})},r=>{let i="Location detection failed",o=!1,a=!1;switch(r.code){case r.PERMISSION_DENIED:i="Location permission denied. Please enable location access in your device settings.",o=!0,a=!0;break;case r.POSITION_UNAVAILABLE:i="Location information is unavailable. Please check your device settings.";break;case r.TIMEOUT:i="Location request timed out. Please try again.";break;default:i=`Location detection failed: ${r.message}`}const u=new Error(i);u.permissionDenied=o,u.shouldShowSettings=a,n(u)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})})}async hasLocationPermission(){return await U.isLocationAuthorized()}async getPermissionStatus(){return await U.getPermissionStatus()}openLocationSettings(){U.openDeviceSettings()}async reverseGeocode(e,t){try{const n=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&zoom=10`,{headers:{"User-Agent":"IslamQA App"}});if(!n.ok)throw new Error("Geocoding failed");const i=(await n.json()).address||{};return i.city||i.town||i.village||i.county||i.state||i.country||"Unknown Location"}catch(n){throw console.error("Reverse geocoding error:",n),n}}getCalculationParams(){const e=this.calculationMethod;let t;switch(e){case"MUSLIM_WORLD_LEAGUE":t=p.MuslimWorldLeague();break;case"EGYPTIAN":t=p.Egyptian();break;case"KARACHI":t=p.Karachi();break;case"UMM_AL_QURA":t=p.UmmAlQura();break;case"DUBAI":t=p.Dubai();break;case"QATAR":t=p.Qatar();break;case"KUWAIT":t=p.Kuwait();break;case"MOONSIGHTING_COMMITTEE":t=p.MoonsightingCommittee();break;case"SINGAPORE":t=p.Singapore();break;case"TURKEY":t=p.Turkey();break;case"TEHRAN":t=p.Tehran();break;case"NORTH_AMERICA":t=p.NorthAmerica();break;default:t=p.MuslimWorldLeague()}switch(this.madhab==="HANAFI"?t.madhab=H.Hanafi:t.madhab=H.Shafi,this.highLatitudeRule){case"MIDDLE_OF_NIGHT":t.highLatitudeRule=b.MiddleOfTheNight;break;case"SEVENTH_OF_NIGHT":t.highLatitudeRule=b.SeventhOfTheNight;break;case"TWILIGHT_ANGLE":t.highLatitudeRule=b.TwilightAngle;break;default:t.highLatitudeRule=b.MiddleOfTheNight}return t}getPrayerTimes(e=new Date){if(!this.location)throw new Error("Location not set. Please set location first.");const t=new q(this.location.latitude,this.location.longitude),n=this.getCalculationParams(),r=new gt(t,e,n);return{fajr:r.fajr,sunrise:r.sunrise,dhuhr:r.dhuhr,asr:r.asr,maghrib:r.maghrib,isha:r.isha,currentPrayer:r.currentPrayer(),nextPrayer:r.nextPrayer(),timeForPrayer:i=>r.timeForPrayer(i)}}getFormattedPrayerTimes(e=new Date){const t=this.getPrayerTimes(e);return{fajr:this.formatTime(t.fajr),sunrise:this.formatTime(t.sunrise),dhuhr:this.formatTime(t.dhuhr),asr:this.formatTime(t.asr),maghrib:this.formatTime(t.maghrib),isha:this.formatTime(t.isha),currentPrayer:t.currentPrayer,nextPrayer:t.nextPrayer}}formatTime(e){if(!e)return"--:--";const t=e.getHours(),n=e.getMinutes(),r=t>=12?"PM":"AM",i=t%12||12,o=n.toString().padStart(2,"0");return`${i}:${o} ${r}`}getTimeUntilNextPrayer(){if(!this.location)return null;const e=this.getPrayerTimes(),t=e.nextPrayer;if(!t)return null;const i=e.timeForPrayer(t)-new Date;if(i<=0)return null;const o=Math.floor(i/(1e3*60*60)),a=Math.floor(i%(1e3*60*60)/(1e3*60)),u=Math.floor(i%(1e3*60)/1e3);return{prayer:this.getPrayerName(t),hours:o,minutes:a,seconds:u,totalSeconds:Math.floor(i/1e3)}}getCurrentPrayerName(){if(!this.location)return null;const t=this.getPrayerTimes().currentPrayer;return t?this.getPrayerName(t):null}getPrayerName(e){return{[c.Fajr]:"Fajr",[c.Sunrise]:"Sunrise",[c.Dhuhr]:"Dhuhr",[c.Asr]:"Asr",[c.Maghrib]:"Maghrib",[c.Isha]:"Isha",[c.None]:"None"}[e]||"Unknown"}getPrayerWindows(e=new Date){if(!this.location)throw new Error("Location not set. Please set location first.");const t=this.getPrayerTimes(e),n=new Date(e);n.setDate(n.getDate()+1);const r=this.getPrayerTimes(n);return[{name:"Fajr",prayer:c.Fajr,start:t.fajr,end:t.sunrise,startFormatted:this.formatTime(t.fajr),endFormatted:this.formatTime(t.sunrise)},{name:"Dhuhr",prayer:c.Dhuhr,start:t.dhuhr,end:t.asr,startFormatted:this.formatTime(t.dhuhr),endFormatted:this.formatTime(t.asr)},{name:"Asr",prayer:c.Asr,start:t.asr,end:t.maghrib,startFormatted:this.formatTime(t.asr),endFormatted:this.formatTime(t.maghrib)},{name:"Maghrib",prayer:c.Maghrib,start:t.maghrib,end:t.isha,startFormatted:this.formatTime(t.maghrib),endFormatted:this.formatTime(t.isha)},{name:"Isha",prayer:c.Isha,start:t.isha,end:r.fajr,startFormatted:this.formatTime(t.isha),endFormatted:this.formatTime(r.fajr)}]}getCurrentPrayerWindow(){if(!this.location)return null;const e=this.getPrayerWindows(),t=new Date;for(const n of e)if(t>=n.start&&t<n.end)return n;return null}getTimeRemainingInCurrentPrayer(){const e=this.getCurrentPrayerWindow();if(!e)return null;const t=new Date,n=e.end-t;if(n<=0)return null;const r=Math.floor(n/(1e3*60*60)),i=Math.floor(n%(1e3*60*60)/(1e3*60)),o=Math.floor(n%(1e3*60)/1e3);return{prayer:e.name,hours:r,minutes:i,seconds:o,totalSeconds:Math.floor(n/1e3),endTime:this.formatTime(e.end)}}getTimeUntilPrayerStarts(e){const t=new Date,n=e.start-t;if(n<=0)return null;const r=Math.floor(n/(1e3*60*60)),i=Math.floor(n%(1e3*60*60)/(1e3*60)),o=Math.floor(n%(1e3*60)/1e3);return{hours:r,minutes:i,seconds:o,totalSeconds:Math.floor(n/1e3)}}getPrayerStatuses(){if(!this.location)return[];const e=this.getPrayerWindows(),t=new Date;return e.map(n=>{const r=t>=n.start&&t<n.end,i=t>=n.end,o=t<n.start;let a=null,u="upcoming";if(r){u="current";const h=n.end-t,m=Math.floor(h/(1e3*60*60)),g=Math.floor(h%(1e3*60*60)/(1e3*60)),f=Math.floor(h%(1e3*60)/1e3);a={type:"ends",hours:m,minutes:g,seconds:f,totalSeconds:Math.floor(h/1e3)}}else if(o){u="upcoming";const h=n.start-t,m=Math.floor(h/(1e3*60*60)),g=Math.floor(h%(1e3*60*60)/(1e3*60)),f=Math.floor(h%(1e3*60)/1e3);a={type:"starts",hours:m,minutes:g,seconds:f,totalSeconds:Math.floor(h/1e3)}}else u="past";return{...n,status:u,countdown:a,isCurrent:r,isPast:i,isUpcoming:o}})}getQiblaDirection(){if(!this.location)throw new Error("Location not set. Please set location first.");const e=new q(this.location.latitude,this.location.longitude),t=ft(e);return Math.round(t)}hasLocation(){return this.location!==null}getTimePeriod(){if(!this.location)return{period:"day",prayer:null};try{const e=this.getPrayerTimes(),t=new Date;return t>=e.fajr&&t<e.sunrise?{period:"fajr",prayer:"Fajr"}:t>=e.sunrise&&t<e.maghrib?{period:"day",prayer:t>=e.dhuhr?t>=e.asr?"Asr":"Dhuhr":"Sunrise"}:t>=e.maghrib&&t<e.isha?{period:"maghrib",prayer:"Maghrib"}:{period:"night",prayer:"Isha"}}catch(e){return console.error("Failed to get time period:",e),{period:"day",prayer:null}}}getTimePeriodGradient(){const{period:e}=this.getTimePeriod(),t={fajr:{from:"from-purple-600 dark:from-purple-700",via:"via-pink-500 dark:via-pink-600",to:"to-orange-500 dark:to-orange-600"},day:{from:"from-sky-500 dark:from-sky-600",via:"via-cyan-500 dark:via-cyan-600",to:"to-teal-500 dark:to-teal-600"},maghrib:{from:"from-orange-500 dark:from-orange-600",via:"via-red-500 dark:via-red-600",to:"to-purple-600 dark:to-purple-700"},night:{from:"from-indigo-800 dark:from-indigo-900",via:"via-purple-800 dark:via-purple-900",to:"to-slate-900 dark:to-black"}};return t[e]||t.day}getTimePeriodIcon(){const{period:e}=this.getTimePeriod();return{fajr:"sun",day:"sun",maghrib:"moon",night:"moon"}[e]||"sun"}reloadSettings(){this.location=this.loadLocation(),this.locationName=this.loadLocationName(),this.calculationMethod=this.loadCalculationMethod(),this.madhab=this.loadMadhab(),this.highLatitudeRule=this.loadHighLatitudeRule()}getSettings(){var e,t,n;return{location:this.location,locationName:this.locationName,calculationMethod:this.calculationMethod,calculationMethodName:((e=Tt[this.calculationMethod])==null?void 0:e.name)||"Unknown",madhab:this.madhab,madhabName:((t=Mt[this.madhab])==null?void 0:t.name)||"Unknown",highLatitudeRule:this.highLatitudeRule,highLatitudeRuleName:((n=pt[this.highLatitudeRule])==null?void 0:n.name)||"Unknown"}}updateWidget(){if(!window.PrayerWidget){console.log("PrayerWidget plugin not available");return}if(!this.location){console.log("Location not set, skipping widget update");return}try{const e=this.getTimeUntilNextPrayer(),t=this.getCurrentPrayerWindow(),n=this.getPrayerTimes(),r=this.getFormattedPrayerTimes(),i={fajr:r.fajr,dhuhr:r.dhuhr,asr:r.asr,maghrib:r.maghrib,isha:r.isha,nextPrayer:(e==null?void 0:e.prayer)||"Fajr",nextPrayerTime:e?this.formatTime(n.timeForPrayer(this.getPrayerEnumFromName(e.prayer))):"--:--",timeRemaining:this.formatWidgetTime(e),currentPrayer:(t==null?void 0:t.name)||"",currentPrayerEnd:t?this.formatTime(t.end):""};window.PrayerWidget.updateWidget(i,()=>console.log("Widget updated successfully:",i),o=>console.error("Widget update failed:",o))}catch(e){console.error("Error updating widget:",e)}}formatWidgetTime(e){if(!e)return"--:--";const{hours:t,minutes:n,seconds:r}=e;return t>0?`${t}h ${n}m`:n>0?`${n}m`:`${r}s`}getPrayerEnumFromName(e){return{Fajr:c.Fajr,Sunrise:c.Sunrise,Dhuhr:c.Dhuhr,Asr:c.Asr,Maghrib:c.Maghrib,Isha:c.Isha}[e]||c.Fajr}isWidgetInstalled(e){if(!window.PrayerWidget){e(!1);return}window.PrayerWidget.isWidgetInstalled(t=>e(t===1),()=>e(!1))}clearSettings(){localStorage.removeItem(A.LOCATION),localStorage.removeItem(A.LOCATION_NAME),localStorage.removeItem(A.CALCULATION_METHOD),localStorage.removeItem(A.MADHAB),localStorage.removeItem(A.HIGH_LATITUDE_RULE),this.location=null,this.locationName="Unknown Location",this.calculationMethod="MUSLIM_WORLD_LEAGUE",this.madhab="SHAFI",this.highLatitudeRule="MIDDLE_OF_NIGHT"}}const Lt=new wt;export{Tt as C,Mt as M,Lt as p};
