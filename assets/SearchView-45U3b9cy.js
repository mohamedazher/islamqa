import{r as f,v as B,e as c,l as t,i as v,A as I,N as L,u as b,p as w,F as S,m as _,B as z,t as y,D as Q,o as u,f as V}from"./vendor-goXqKlOD.js";import{u as M,_ as x}from"./index-C2EJApSe.js";import{F as $}from"./search-Ch1WBRTM.js";import{Q as D}from"./QuestionListItem-Ny9Qfla_.js";class R{constructor(s=[]){this.questions=s,this.fuseInstance=null,this.initializeFuse()}initializeFuse(){if(this.questions.length===0){console.warn("SearchService: No questions provided for search");return}this.fuseInstance=new $(this.questions,{keys:[{name:"title",weight:.7},{name:"question",weight:.3}],threshold:.4,ignoreLocation:!0,minMatchCharLength:2,useExtendedSearch:!1,includeScore:!0,isCaseSensitive:!1})}updateQuestions(s){this.questions=s,this.initializeFuse()}fuzzySearch(s){return!s||s.trim().length===0?[]:this.fuseInstance?this.fuseInstance.search(s.trim()).map(a=>({...a.item,score:a.score})):(console.warn("SearchService: Fuse not initialized"),[])}search(s){if(!s||s.trim().length===0)return[];const o=s.trim().toLowerCase(),a=this.questions.filter(n=>{const m=n.title?n.title.toLowerCase():"",p=n.question?n.question.toLowerCase():"";return m.includes(o)||p.includes(o)}),i=this.fuzzySearch(s),d=new Set(a.map(n=>n.reference)),h=i.filter(n=>!d.has(n.reference));return[...a,...h]}searchByCategory(s,o){return this.search(s).filter(i=>i.primary_category===o||i.categories&&i.categories.includes(o))}getSuggestions(s,o=10){return this.search(s).slice(0,o)}}const j={class:"search-view h-full flex flex-col bg-neutral-50 dark:bg-neutral-950"},E={class:"bg-gradient-to-r from-primary-600 to-primary-800 dark:from-primary-700 dark:to-primary-900 text-white p-4 shadow"},A={class:"flex items-center gap-3 mb-3"},J={class:"relative"},O={class:"absolute left-3 top-2.5 text-neutral-400 dark:text-neutral-500"},U={class:"flex-1 overflow-y-auto p-4"},G={key:0,class:"mb-6"},K={class:"space-y-2"},P=["onClick"],W={class:"text-neutral-700 dark:text-neutral-300"},X={class:"float-right text-neutral-400 dark:text-neutral-500 text-sm"},Y={key:1,class:"flex items-center justify-center h-32"},Z={key:2},ee={class:"mb-3"},te={class:"text-sm text-neutral-600 dark:text-neutral-400"},se={class:"font-semibold text-primary-600 dark:text-primary-400"},re={class:"grid grid-cols-1 gap-3"},ae={key:3,class:"text-center py-12"},ne={class:"w-20 h-20 bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center mx-auto mb-4"},le={key:4,class:"text-center py-12"},ie={class:"w-20 h-20 bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center mx-auto mb-4"},fe={__name:"SearchView",setup(C){const s=Q(),o=M(),a=f(""),i=f([]),d=f(!1),h=f(!1),n=f([]),m=f(null);function p(){const r=localStorage.getItem("searchHistory");r&&(n.value=JSON.parse(r).slice(0,5))}function F(r){if(!r||r.trim().length===0)return;const e=r.trim();n.value=n.value.filter(l=>l!==e),n.value.unshift(e),n.value=n.value.slice(0,5),localStorage.setItem("searchHistory",JSON.stringify(n.value))}const g=(()=>{let r;return()=>{if(clearTimeout(r),a.value.trim().length===0){i.value=[];return}d.value=!0,r=setTimeout(()=>{m.value&&(i.value=m.value.search(a.value)),d.value=!1},300)}})();function q(r){a.value=r,g()}function T(r){F(a.value),s.push(`/question/${r.reference}`)}function H(){setTimeout(()=>{a.value.trim().length>0&&(h.value=!1)},100)}function N(){s.back()}return B(async()=>{try{p();const r=await o.getAllQuestions();m.value=new R(r),console.log("ðŸ” Search service initialized with",r.length,"questions")}catch(r){console.error("Error initializing search:",r)}}),(r,e)=>(u(),c("div",j,[t("header",E,[t("div",A,[t("button",{onClick:N,class:"hover:opacity-80 transition-opacity flex-shrink-0"},[v(x,{name:"arrowLeft",size:"md"})]),e[3]||(e[3]=t("h1",{class:"text-lg font-bold"},"Search Questions",-1))]),t("div",J,[I(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>a.value=l),onInput:e[1]||(e[1]=(...l)=>b(g)&&b(g)(...l)),onFocus:e[2]||(e[2]=l=>h.value=!0),onBlur:H,type:"text",placeholder:"Search questions...",class:"w-full px-4 py-2 pl-10 rounded-lg text-neutral-900 dark:text-neutral-100 placeholder-neutral-500 dark:placeholder-neutral-400 bg-white dark:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-primary-300 dark:focus:ring-primary-600",autofocus:""},null,544),[[L,a.value]]),t("span",O,[v(x,{name:"search",size:"md"})])])]),t("div",U,[h.value&&!a.value&&n.value.length>0?(u(),c("div",G,[e[4]||(e[4]=t("h3",{class:"text-base sm:text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-3"},"Recent Searches",-1)),t("div",K,[(u(!0),c(S,null,_(n.value,(l,k)=>(u(),c("button",{key:k,onClick:oe=>q(l),class:"w-full text-left bg-white dark:bg-neutral-800 rounded-lg shadow p-3 hover:bg-primary-50 dark:hover:bg-primary-900/20 transition"},[t("span",W,y(l),1),t("span",X,[v(x,{name:"chevronRight",size:"sm"})])],8,P))),128))])])):w("",!0),d.value?(u(),c("div",Y,[...e[5]||(e[5]=[t("div",{class:"text-center"},[t("div",{class:"animate-spin rounded-full h-10 w-10 border-b-2 border-primary-600 dark:border-primary-400 mx-auto mb-3"}),t("p",{class:"text-neutral-600 dark:text-neutral-400"},"Searching...")],-1)])])):i.value.length>0?(u(),c("div",Z,[t("div",ee,[t("p",te,[e[6]||(e[6]=z(" Found ",-1)),t("span",se,y(i.value.length),1),z(" result"+y(i.value.length!==1?"s":""),1)])]),t("div",re,[(u(!0),c(S,null,_(i.value,l=>(u(),V(D,{key:l.reference,question:l,onClick:k=>T(l)},null,8,["question","onClick"]))),128))])])):a.value&&!d.value?(u(),c("div",ae,[t("div",ne,[v(x,{name:"search",size:"xl",class:"text-neutral-400 dark:text-neutral-600"})]),e[7]||(e[7]=t("h3",{class:"text-base sm:text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-2"},"No results found",-1)),e[8]||(e[8]=t("p",{class:"text-neutral-600 dark:text-neutral-400 mb-4"},"Try different keywords or check your spelling",-1)),e[9]||(e[9]=t("p",{class:"text-sm text-neutral-500 dark:text-neutral-500"},'Fuzzy search enabled: "profet" will find "prophet"',-1))])):!a.value&&!h.value?(u(),c("div",le,[t("div",ie,[v(x,{name:"search",size:"xl",class:"text-neutral-400 dark:text-neutral-600"})]),e[10]||(e[10]=t("h3",{class:"text-base sm:text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-2"},"Start searching",-1)),e[11]||(e[11]=t("p",{class:"text-neutral-600 dark:text-neutral-400"},"Find questions by keyword or topic",-1))])):w("",!0)])]))}};export{fe as default};
